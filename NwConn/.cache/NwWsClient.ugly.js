(function(e,t){typeof module!="undefined"&&(NwLib=require("../NwLib/NwLib.js"),Class=NwLib.Nwjsface.Class,NwDataMsgObj=require("../NwUtil/NwDataMsgObj.js"),io=require("socket.io-client"));var n=Class(function(){return{wsServerUrl:"",socket:{},_pastId:"",constructor:function(e){var t=this;this.wsServerUrl=e,this.socket=io(this.wsServerUrl),this._initConnectionListen()},_initConnectionListen:function(){var e=this;e.socket.on("connect",function(){e._pastId=e.getId(),e._onConnectEventListener&&e._onConnectEventListener(e.socket),e.socket.on("cmd",function(t,n){if(e._onMessageEventListener){e._onMessageEventListener(e.socket,t,n);try{}catch(r){console.log("err NwWsClient :"+r)}}}),e.socket.on("disconnect",function(){e._onDisconnectEventListener&&e._onDisconnectEventListener(e.socket)})})},getId:function(){var e=this.socket.io.engine.id;return e?e:this._pastId},getUri:function(){return this.socket.io.uri},getIp:function(){return this.getUri().split("/")[2].split(":")[0]},disconnect:function(e){this.socket.disconnect()},callService:function(e,t,n){var r=new NwDataMsgObj;r.msg=e,r.cat="callService",r.data=t,r.type=t?typeof t:null,this.sendMsgObj(r,function(e){n&&(e?n(e.data,e.type):n())})},sendMsgObj:function(e,t){this.socket.emit("cmd",e,t)},regEvent:function(e,t){var n=this;n.socket.on(e,function(e){t(e.data,e.type)})},emitEvent:function(e,t,n){var r=new NwDataMsgObj;r.msg=e,r.cat="event",r.data=t,r.type=typeof t,this.socket.emit(e,r.getObj(),n)},_onConnectEventListener:null,setOnConnectEventListener:function(e){this._onConnectEventListener=e},_onDisconnectEventListener:null,setOnDisconnectEventListener:function(e){this._onDisconnectEventListener=e},_onMessageEventListener:null,setOnMessageEventListener:function(e){this._onMessageEventListener=e}}});typeof module!="undefined"&&module.exports?module.exports=n:e.NwWsClient=n})(this);