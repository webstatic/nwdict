(function(context,undefined){if(typeof module!=="undefined"){NwLib=require("../NwLib/NwLib.js");Class=NwLib.Nwjsface.Class;NwDataMsgObj=require("../NwUtil/NwDataMsgObj.js");io=require("socket.io-client")}else{}var NwWsClient=Class(function(){return{wsServerUrl:"",socket:{},_pastId:"",constructor:function(wsServerUrl){var self=this;this.wsServerUrl=wsServerUrl;this.socket=io(this.wsServerUrl);this._initConnectionListen()},_initConnectionListen:function(){var self=this;self.socket.on("connect",function(){self._pastId=self.getId();if(self._onConnectEventListener){self._onConnectEventListener(self.socket)}self.socket.on("cmd",function(msgObj,fn){if(self._onMessageEventListener){self._onMessageEventListener(self.socket,msgObj,fn);try{}catch(e){console.log("err NwWsClient :"+e)}}});self.socket.on("disconnect",function(){if(self._onDisconnectEventListener){self._onDisconnectEventListener(self.socket)}})})},getId:function(){var id=this.socket.io.engine.id;return id?id:this._pastId},getUri:function(){return this.socket.io.uri},getIp:function(){return this.getUri().split("/")[2].split(":")[0]},disconnect:function(socketId){this.socket.disconnect()},callService:function(msg,data,cb){var msgObj=new NwDataMsgObj;msgObj.msg=msg;msgObj.cat="callService";msgObj.data=data;msgObj.type=data?typeof data:null;this.sendMsgObj(msgObj,function(msgObj){if(cb){if(msgObj){cb(msgObj.data,msgObj.type)}else{cb()}}})},sendMsgObj:function(msgObj,cb){this.socket.emit("cmd",msgObj,cb)},regEvent:function(eventName,cb){var self=this;self.socket.on(eventName,function(msgObj){cb(msgObj.data,msgObj.type)})},emitEvent:function(eventName,resultObj,cb){var msgObj=new NwDataMsgObj;msgObj.msg=eventName;msgObj.cat="event";msgObj.data=resultObj;msgObj.type=typeof resultObj;this.socket.emit(eventName,msgObj.getObj(),cb)},_onConnectEventListener:null,setOnConnectEventListener:function(eventListener){this._onConnectEventListener=eventListener},_onDisconnectEventListener:null,setOnDisconnectEventListener:function(eventListener){this._onDisconnectEventListener=eventListener},_onMessageEventListener:null,setOnMessageEventListener:function(eventListener){this._onMessageEventListener=eventListener}}});if(typeof module!=="undefined"&&module.exports){module.exports=NwWsClient}else{context.NwWsClient=NwWsClient}})(this);