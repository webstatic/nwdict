<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../lib/lokijs/lokijs.js"></script>

    <script>
        var idbAdapter = Object;
        var dbstring;
        idbAdapter.prototype.loadDatabase = function (dbname, callback) {
            callback(dbstring);
        }

        idbAdapter.prototype.saveDatabase = function (dbname, dbstring, callback) {
            callback(dbstring, dbname);
        }

        var db = new loki('test', { adapter: new idbAdapter() });

        var coll = db.addCollection('datas');
        coll.ensureIndex('newwwwwwwwwwwwwww', true);

        coll.insert([{ a: 1 }, { a: 2 }, { a: 3 }]);

        //db.loadDatabase(function (serializedDb) {
        //    console.log('cb', serializedDb);
        //});
        db.saveDatabase(function (str) {
            console.log(str);
            var db2 = new loki('test2', { adapter: new idbAdapter() });
            dbstring = str;
            db2.loadDatabase();

            console.log(db2.getCollection('datas').count());
        });


    </script>
</head>
<body>
</body>
</html>
